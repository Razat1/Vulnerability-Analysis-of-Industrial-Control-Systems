<?php
session_start();
require_once "config.php";
use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;

/* Exception class. */
require 'C:\PHPMailer\src\Exception.php';

/* The main PHPMailer class. */
require 'C:\PHPMailer\src\PHPMailer.php';

/* SMTP class, needed if you want to use SMTP. */
require 'C:\PHPMailer\src\SMTP.php';

$email = new PHPMailer(TRUE);
/* ... */

// Get user enter email via $.ajax() method
if(isset($_POST['uemail']))	
{
	$email = strip_tags($_POST["uemail"]);	

	// Select email from the user table 
	$select_stmt=$db->prepare("SELECT * FROM employee WHERE email=:uemail");  
	$select_stmt->execute(array(":uemail"=>$email));	
	$row=$select_stmt->fetch(PDO::FETCH_ASSOC);
			
	if($select_stmt->rowCount() > 0)	
	{
		// If email present in the table, then sends email to user mailbox / junk box
		if($email==$row["email"]) 
		{
			$email = $row["Email"]; 
			$EmployeeId = $row["EmployeeId"];

			// They can click on this link to reset the password with the token. 
			$reset_link = "Hi, $email. Click here to reset your password
			http://localhost:8888/reset_password.php?email=$email";
					
			
			// $mail=new PHPMailer(true);
			// $mail->isSMTP();
			// $mail->Host="smtp.gmail.com";
			// $mail->Port=587;
			// $mail->SMTPSecure="tls";
			// $mail->SMTPAuth=true;
			// $mail->Username=""; //Enter your gmail id
			// $mail->Password=""; //Enter your gmail password
			// $mail->SetFrom(""); //Enter your gmail id
			// $mail->addAddress($email);
			// $mail->IsHTML(true);
			// $mail->Subject="Reset Password";
			// $mail->Body = ($reset_link);
			// $mail->SMTPOptions=array('ssl'=>array(
					// 	'verify_peer'=>false,
					// 	'verify_peer_name'=>false,
					// 	'allow_self_signed'=>false
					// ));
			if($mail->send())
			{
				$_SESSION["successMsg"] = "email send check your mail box";
				header("location:index.php");
			}
			else
			{
				echo "Mailer Error: " . $mail->ErrorInfo;
			}
		}
		else
		{
			$_SESSION["errorMsg"]="email not found";
			header("location:index.php");
		}
	}
	else
	{
		$_SESSION["errorMsg"]="wrong email";
		header("location:index.php");
	}			
}
?>

